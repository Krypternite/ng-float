!function(n){var i={};function o(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}o.m=n,o.c=i,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=20)}([function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e,n){var i=n(10),o="object"==typeof self&&self&&self.Object===Object&&self,r=i||o||Function("return this")();t.exports=r},function(t,e,n){var i=n(1).Symbol;t.exports=i},function(t,e){t.exports=$.ui.draggable},function(t,e){t.exports=$.ui.resizable},function(t,e){t.exports=angular},function(t,e,n){var r=n(8),a=n(0);t.exports=function(t,e,n){var i=!0,o=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return a(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),r(t,e,{leading:i,maxWait:e,trailing:o})}},function(t,e,n){},function(t,e,n){var y=n(0),w=n(9),b=n(12),x=Math.max,k=Math.min;t.exports=function(i,n,t){var o,r,a,s,u,l,f=0,c=!1,h=!1,e=!0;if("function"!=typeof i)throw new TypeError("Expected a function");function p(t){var e=o,n=r;return o=r=void 0,f=t,s=i.apply(n,e)}function m(t){var e=t-l;return void 0===l||n<=e||e<0||h&&a<=t-f}function d(){var t=w();if(m(t))return v(t);u=setTimeout(d,function(t){var e=n-(t-l);return h?k(e,a-(t-f)):e}(t))}function v(t){return u=void 0,e&&o?p(t):(o=r=void 0,s)}function g(){var t=w(),e=m(t);if(o=arguments,r=this,l=t,e){if(void 0===u)return function(t){return f=t,u=setTimeout(d,n),c?p(t):s}(l);if(h)return u=setTimeout(d,n),p(l)}return void 0===u&&(u=setTimeout(d,n)),s}return n=b(n)||0,y(t)&&(c=!!t.leading,a=(h="maxWait"in t)?x(b(t.maxWait)||0,n):a,e="trailing"in t?!!t.trailing:e),g.cancel=function(){void 0!==u&&clearTimeout(u),o=l=r=u=void(f=0)},g.flush=function(){return void 0===u?s:v(w())},g}},function(t,e,n){var i=n(1);t.exports=function(){return i.Date.now()}},function(n,t,e){(function(t){var e="object"==typeof t&&t&&t.Object===Object&&t;n.exports=e}).call(this,e(11))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){var i=n(0),o=n(13),r=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,u=/^0o[0-7]+$/i,l=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(o(t))return NaN;if(i(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=i(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(r,"");var n=s.test(t);return n||u.test(t)?l(t.slice(2),n?2:8):a.test(t)?NaN:+t}},function(t,e,n){var i=n(14),o=n(17);t.exports=function(t){return"symbol"==typeof t||o(t)&&"[object Symbol]"==i(t)}},function(t,e,n){var i=n(2),o=n(15),r=n(16),a=i?i.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":a&&a in Object(t)?o(t):r(t)}},function(t,e,n){var i=n(2),o=Object.prototype,r=o.hasOwnProperty,a=o.toString,s=i?i.toStringTag:void 0;t.exports=function(t){var e=r.call(t,s),n=t[s];try{var i=!(t[s]=void 0)}catch(t){}var o=a.call(t);return i&&(e?t[s]=n:delete t[s]),o}},function(t,e){var n=Object.prototype.toString;t.exports=function(t){return n.call(t)}},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e,n){},function(t,e,n){},function(t,e,n){"use strict";n.r(e);var i=n(5),o=n.n(i),r=n(6),u=n.n(r);function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var s=function(){function i(t,e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this.top=e,(this.items=t).forEach(function(t){return t.row=n})}return function(t,e,n){e&&a(t.prototype,e),n&&a(t,n)}(i,[{key:"addItem",value:function(t){this.items.push(t),t.row=this}},{key:"removeItem",value:function(t){var e=this.items.indexOf(t);t.row=null,this.items.splice(e,1)}},{key:"setTop",value:function(t){var e=this;this.top=t,this.items.forEach(function(t){return t.top=e.top})}},{key:"getHeight",value:function(){return this.items.reduce(function(t,e){return Math.max(t,e.height)},0)}},{key:"getOverlap",value:function(e,n){var i=0;return this.items.forEach(function(t){t.doesOverlap(e)&&(i=n?Math.max(i,e.top+e.height-t.top):Math.max(i,t.top+t.height-e.top))}),i}}]),i}();function l(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function f(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var c=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];for(!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);t.sort(function(t,e){return 1e4*(t.top-e.top)+t.left-e.left}),this.positionItems(t););this.rows=this.itemsToRows(t)}return function(t,e,n){e&&f(t.prototype,e),n&&f(t,n)}(e,[{key:"positionItems",value:function(t){for(var e=!1,n=0;n<t.length;n++)for(var i=n+1;i<t.length;i++)t[n].doesOverlap(t[i])&&(t[n].top<=t[i].top?t[i].top=t[n].top+t[n].height:t[n].top>t[i].top&&(t[n].top=t[i].top+t[i].height),e=!0,console.warn(t[n],"".concat(n," overlaps ").concat(i),t[i]));return e}},{key:"itemsToRows",value:function(t){var o=this,e={};return t.forEach(function(t){t.top in e?e[t.top].push(t):e[t.top]=[t]}),Object.entries(e).map(function(t){var e=l(t,2),n=e[0],i=e[1];return new s(i,Number(n),o)}).sort(function(t,e){return t.top-e.top})}},{key:"addItem",value:function(t){var e,n;for(e=0;e<this.rows.length;e++){if(!(this.rows[e].top<t.top)){this.rows[e].top===t.top&&(n=this.rows[e]);break}t.top+=this.rows[e].getOverlap(t,!1)}n&&!n.getOverlap(t,!0)?n.addItem(t):this.rows.splice(e,0,new s([t],t.top,this));for(var i=e+1;i<this.rows.length;i++)this.shiftRows(this.rows.slice(i),this.rows[i].getOverlap(t,!0))}},{key:"editItem",value:function(t,e){this.removeItem(t),this.addItem(Object.assign(t,e))}},{key:"removeItem",value:function(t){var e=t.row;e.removeItem(t),0===e.items.length&&this.rows.splice(this.rows.indexOf(e),1)}},{key:"shiftRows",value:function(t,e){t.forEach(function(t){return t.setTop(t.top+e)})}},{key:"removeGaps",value:function(){if(0!==this.rows.length){0!==this.rows[0].top&&this.shiftRows(this.rows,-this.rows[0].top);for(var t=0,e=1;e<this.rows.length;e++){t=Math.max(t,this.rows[e-1].top+this.rows[e-1].getHeight());var n=this.rows[e].top-t;0<n&&this.shiftRows(this.rows.slice(e),-n)}}}},{key:"getMaxHeight",value:function(){return this.rows.reduce(function(t,e){return Math.max.apply(void 0,[t].concat(e.items.map(function(t){return t.top+t.height})))},0)}},{key:"getClosestTop",value:function(t){if(0===this.rows.length)t.top=0;else for(var e=this.rows.length-1;0<=e;e--)if(this.rows[e].top<t.top){t.top=this.rows[e].top,t.top+=this.rows[e].getOverlap(t,!1);break}return t}},{key:"getWidthAtPos",value:function(t){var e=t.left,n=t.top,i=0,o=1/0;return this.rows.forEach(function(t){if(t.top>=n)return!1;t.items.forEach(function(t){t.top+t.height>n&&(t.left<e?i=Math.max(i,t.left+t.width):o=Math.min(o,t.left))})}),{left:i,width:o-i}}}]),e}();function h(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}n(3),n(4);function p(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var m=function(){function o(t,e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this.left=t,this.top=e,this.width=n,this.height=i,this.row=null}return function(t,e,n){e&&p(t.prototype,e),n&&p(t,n)}(o,[{key:"doesOverlap",value:function(t){return!(this.left+this.width<=t.left||t.left+t.width<=this.left||this.top+this.height<=t.top||t.top+t.height<=this.top)}}]),o}();n(18),n(19);function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function v(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function g(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var y=function(){function p(t){var e=t.width,n=void 0===e?768:e,i=t.rowHeight,o=void 0===i?15:i,r=t.numColumns,a=void 0===r?60:r,s=t.buffer,u=void 0===s?4:s,l=t.minHeight,f=void 0===l?4:l,c=t.minWidth,h=void 0===c?10:c;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,p),this.width=n,this.numColumns=a,this.buffer=u,this.rowHeight=o,this.minHeight=f,this.minWidth=h,this.colWidth=(n-(a-1)*u)/a+u}return function(t,e,n){e&&g(t.prototype,e),n&&g(t,n)}(p,[{key:"px2layout",value:function(t){var e=t.left,n=t.top,i=t.width,o=t.height,r=this.px2pos({left:e,top:n}),a=Math.ceil((this.left2px(r.left)+i)/this.colWidth),s=Math.ceil((this.top2px(r.top)+o+this.buffer)/this.rowHeight);return{left:r.left,top:r.top,width:a-r.left,height:s-r.top}}},{key:"layout2px",value:function(t){var e=t.left,n=t.top,i=t.width,o=t.height;return{left:this.left2px(e),top:this.top2px(n),width:this.width2px(i),height:this.height2px(o)}}},{key:"px2pos",value:function(t){var e=t.left,n=t.top;return{left:this._closestMultiple(e,this.colWidth),top:this._closestMultiple(n,this.rowHeight)}}},{key:"left2px",value:function(t){return t*this.colWidth}},{key:"top2px",value:function(t){return t*this.rowHeight}},{key:"width2px",value:function(t){return t*this.colWidth-this.buffer}},{key:"height2px",value:function(t){return t*this.rowHeight-this.buffer}},{key:"getClosestPosition",value:function(t){return this.checkPositionConstraints(this.px2layout(t))}},{key:"getClosestSize",value:function(t,e){return this.checkSizeConstraints(this.px2layout(t),e)}},{key:"checkPositionConstraints",value:function(t){var e=t.width,n=t.height,i=t.left,o=t.top;return i+e>this.numColumns&&(i=this.numColumns-e),i<0&&(i=0),o<0&&(o=0),{left:i,top:o,width:e,height:n}}},{key:"checkSizeConstraints",value:function(t,e){var n=t.width,i=t.height,o=t.left,r=t.top;o+n>this.numColumns&&(n=this.numColumns-o),o<0&&(n=o+n-(o=0));return n<this.minWidth&&(e&&(o-=this.minWidth-n),n=this.minWidth),i<this.minHeight&&(i=this.minHeight),{left:o,top:r,width:n,height:i}}},{key:"_closestMultiple",value:function(t,e){var n=t/e,i=Math.floor(n),o=Math.ceil(n);return o-n<n-i?o:i}}]),p}();n(7),e.default=o.a.module("float",[]).directive("flContainer",function(){return{restrict:"A",bindToController:{options:"=flContainer",isEditable:"=flEditable",createElementsAtPosition:"&flCreateElementsAtPosition"},controllerAs:"flContainer",controller:["Mapper","$element","$document","$scope","$timeout",function(){function r(t,e,n,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),this.flItems=[],this.Mapper=t,this.$element=e,this.$document=n,this.$scope=i,this.$timeout=o}return function(t,e,n){e&&h(t.prototype,e),n&&h(t,n)}(r,[{key:"$onInit",value:function(){var t=this;this.mapper=new this.Mapper(this.options),this.$element.css("width",this.mapper.width),this.isTouchDevice()&&this.$element.addClass("fl-touch"),this.isEditable&&(this.setupDropListeners(),this.setupVisitListeners(this.$document,this.$scope)),this.$timeout(function(){t.container||0!==t.flItems.length||(t.container=new c,t.render())},500)}},{key:"initItem",value:function(t){var e=this;this.flItems.push(t),this.container?(this.container.addItem(t.item),this.render()):t.lastRepeat&&(this.container=new c(this.flItems.map(function(t){return t.item})),this.$timeout(function(){e.render()}))}},{key:"render",value:function(){var e=this;this.container.removeGaps(),this.$element.css("height",this.mapper.height2px(this.container.getMaxHeight())+(this.isEditable?100:0)),this.flItems.forEach(function(t){return t.render(e.mapper.layout2px(t.item),{left:t.item.left,top:t.item.top,width:t.item.width,height:t.item.height})})}},{key:"onItemEditStart",value:function(){this.$element.addClass("fl-container-editing"),this.$element.css("height",this.$element.height()+1e3)}},{key:"onItemEditEnd",value:function(t,e){this.$element.removeClass("fl-container-editing"),this.container.editItem(t,e),this.render()}},{key:"onItemRemove",value:function(e){this.flItems=this.flItems.filter(function(t){return t!==e}),this.container.removeItem(e.item),this.render()}},{key:"getNewItemDimensions",value:function(t){return this.container.getClosestTop(this.mapper.getClosestPosition(t))}},{key:"setupDropListeners",value:function(){var o=this;function r(t,e,n){var i=0<arguments.length&&void 0!==t?t:-1e4,o=1<arguments.length&&void 0!==e?e:-1e4,r=2<arguments.length&&void 0!==n?n:0;a.css({marginLeft:i,marginTop:o,width:r})}var a=angular.element("<div>").addClass("fl-drop-indicator").appendTo(this.$element);r();var s=u()(function(t){if(angular.element(t.target).is(o.$element)){var e=o.mapper.px2pos({left:t.offsetX,top:t.offsetY}),n=Object.assign(e,o.container.getWidthAtPos(e));if(n.height=o.mapper.minHeight,n.width=Math.min(n.width,o.mapper.numColumns-n.left),n.width<o.mapper.minWidth)r();else{var i=o.mapper.layout2px(o.mapper.checkPositionConstraints(n));r(i.left,i.top,i.width)}}else r()},50);this.$element.on("dragover",function(t){t.preventDefault(),t.stopPropagation(),s(t)}),this.$element.on("dragleave",function(t){t.preventDefault(),t.stopPropagation(),s.cancel(),r()}),this.$element.on("drop",function(t){if(t.preventDefault(),t.stopPropagation(),s.cancel(),r(),angular.element(t.target).is(o.$element)){var e=o.mapper.px2pos({left:t.offsetX,top:t.offsetY}),n=Object.assign(e,o.container.getWidthAtPos(e));if(n.height=o.mapper.minHeight,n.width>=o.mapper.minWidth){n.width=Math.min(n.width,o.mapper.numColumns-n.left);var i=o.mapper.checkPositionConstraints(n);o.createElementsAtPosition({event:t,dimensions:i})}}})}},{key:"setupVisitListeners",value:function(t,e){function n(t){var e=angular.element(t.target).closest("[fl-item]").eq(0);e&&e.addClass("fl-item-selected"),angular.element("[fl-item]").not(e).removeClass("fl-item-selected")}t.on("click",n),e.$on("$destroy",function(){t.off("click",n)})}},{key:"isTouchDevice",value:function(){return"ontouchstart"in window||0<navigator.MaxTouchPoints||0<navigator.msMaxTouchPoints}}]),r}()]}}).directive("flItem",function(){return{restrict:"A",require:["^flContainer","flItem"],bindToController:{layout:"=flItem",resizable:"=flResizable",getHeight:"=flGetHeight",lastRepeat:"=flLastRepeat",isEditable:"=flEditable"},controllerAs:"flItem",controller:["$element",function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.$element=t}return function(t,e,n){e&&v(t.prototype,e),n&&v(t,n)}(e,[{key:"$onInit",value:function(){this.item=new m(this.layout.left,this.layout.top,this.layout.width,this.layout.height)}},{key:"render",value:function(t,e){this.$element.css(t),Object.assign(this.layout,e)}}]),e}()],link:function(r,a,t,e){var n=d(e,2),s=n[0],u=n[1],o=u.resizable;function l(){a.resizable("option","handles",1===o?"e, w":"e, se, s, sw, w")}function f(t,e){if(u.getHeight){var n=s.mapper.layout2px(t),i=u.getHeight(a,n.width,e);if(0<i&&(o<2||i>n.height))return n.height=i,s.mapper.px2layout(n)}return t}s.initItem(u),a.addClass("fl-item"),s.isEditable&&(a.addClass("fl-edit"),r.$on("$destroy",function(){s.onItemRemove(u)}),u.isEditable&&(function(){var i=angular.element("<"+a[0].nodeName.toLowerCase()+">").addClass("fl-drag-indicator fl-item"),e=angular.element("<div>").addClass("fl-drag-clone");e.append(i);var o={};a.draggable({cursor:"move",cancel:"[fl-drag-cancel]",helper:function(){return e},start:function(t){o.width=a.outerWidth(),o.height=a.outerHeight(),e.css(s.mapper.layout2px(u.item)),i.css(s.mapper.layout2px(u.item)),a.children().clone().appendTo(i),s.onItemEditStart(),r.$broadcast("flDragStart",t)},drag:function(t,e){var n=s.mapper.layout2px(s.mapper.getClosestPosition(Object.assign(o,e.position)));i.css({left:n.left-e.position.left,top:n.top-e.position.top})},stop:function(t,e){i.empty(),s.onItemEditEnd(u.item,s.mapper.getClosestPosition(Object.assign(o,e.position))),r.$broadcast("flDragStop",t)}})}(),function(){if(!o)return;var n;function i(t){return f(s.mapper.getClosestSize(Object.assign(t.position,t.size),a.data("ui-resizable").axis.includes("w")),!0)}a.resizable({classes:{"ui-resizable-handle":"fl-resizable","ui-resizable-se":""},start:function(t){(n=angular.element("<div>").addClass("fl-resize-indicator fl-item")).css(s.mapper.layout2px(u.item)),n.appendTo("[fl-container]"),s.onItemEditStart(),r.$broadcast("flResizeStart",t)},resize:function(t,e){n.css(s.mapper.layout2px(i(e)))},stop:function(t,e){n.remove(),s.onItemEditEnd(u.item,i(e)),r.$broadcast("flResizeStop",t)}}),l()}(),r.$on("flItemChanged",function(){var t=f(u.item,!1);t.height!==u.item.height&&s.onItemEditEnd(u.item,t)}),r.$on("flResizeChanged",function(t,e){o=e,l()})))}}}).factory("Mapper",function(){return y})}]);